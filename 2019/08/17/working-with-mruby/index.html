<!DOCTYPE html>
<html>
<!-- Generated using weaver: https://github.com/davidsiaw/weaver -->
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Working with mruby</title>

    <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../../font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="../../../../css/plugins/iCheck/custom.css" rel="stylesheet">

      <link href="../../../../css/style-dark.css" rel="stylesheet">


    <link href="../../../../css/animate.css" rel="stylesheet">

    <link href="../../../../css/dracula.css" rel="stylesheet">

    <link href="../../../../css/ourown.css" rel="stylesheet">




</head>

<body class=' fixed-sidebar'>

<div id="background" style="z-index: -999; position:absolute; left:0px; right:0px; width:100%; height:100%">

</div>

<div id="content" style="z-index: 0">

	<div id="wrapper">

		<nav class="navbar-default navbar-static-side" role="navigation">
			<div class="sidebar-collapse">
				<ul class="nav" id="side-menu">


	                <li>
	                    <a href="https://davidsiaw.github.io/"><i class="fa fa-home"></i> <span class="nav-label">Home</span> <span class="label label-primary pull-right"></span></a>
	                </li>

<li ><a href="https://davidsiaw.github.io/categories/FPGA"><i class="fa fa-folder"></i><span class="nav-label">FPGA</span></a></li><li ><a href="https://davidsiaw.github.io/categories/Random"><i class="fa fa-folder"></i><span class="nav-label">Random</span></a></li><li ><a href="https://davidsiaw.github.io/categories/Programming"><i class="fa fa-folder"></i><span class="nav-label">Programming</span></a></li><li ><a href="https://davidsiaw.github.io/categories/Philosophy"><i class="fa fa-folder"></i><span class="nav-label">Philosophy</span></a></li><li ><a href="https://davidsiaw.github.io/categories/Math"><i class="fa fa-folder"></i><span class="nav-label">Math</span></a></li><li ><a href="https://davidsiaw.github.io/categories/Hexlife"><i class="fa fa-folder"></i><span class="nav-label">Hexlife</span></a></li><li ><a href="https://davidsiaw.github.io/categories/Graphics"><i class="fa fa-folder"></i><span class="nav-label">Graphics</span></a></li><li open="true"><a href="https://davidsiaw.github.io/#"><i class="fa fa-calendar"></i><span class="nav-label">History</span><span class="fa arrow"></span></a><ul class="nav nav-second-level collapse in"><li ><a href="https://davidsiaw.github.io/2025/07"><i class="fa fa-calendar-o"></i><span class="nav-label">2025/07 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2025/03"><i class="fa fa-calendar-o"></i><span class="nav-label">2025/03 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2020/05"><i class="fa fa-calendar-o"></i><span class="nav-label">2020/05 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2019/08"><i class="fa fa-calendar-check-o"></i><span class="nav-label">2019/08 (1) <br><i class='fa fa-chevron-right'></i>Working with mruby</span></a></li><li ><a href="https://davidsiaw.github.io/2018/08"><i class="fa fa-calendar-o"></i><span class="nav-label">2018/08 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2016/04"><i class="fa fa-calendar-o"></i><span class="nav-label">2016/04 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2015/12"><i class="fa fa-calendar-o"></i><span class="nav-label">2015/12 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2015/06"><i class="fa fa-calendar-o"></i><span class="nav-label">2015/06 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2015/01"><i class="fa fa-calendar-o"></i><span class="nav-label">2015/01 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2014/11"><i class="fa fa-calendar-o"></i><span class="nav-label">2014/11 (2)</span></a></li><li ><a href="https://davidsiaw.github.io/2014/10"><i class="fa fa-calendar-o"></i><span class="nav-label">2014/10 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2013/10"><i class="fa fa-calendar-o"></i><span class="nav-label">2013/10 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2013/03"><i class="fa fa-calendar-o"></i><span class="nav-label">2013/03 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2012/12"><i class="fa fa-calendar-o"></i><span class="nav-label">2012/12 (2)</span></a></li><li ><a href="https://davidsiaw.github.io/2012/11"><i class="fa fa-calendar-o"></i><span class="nav-label">2012/11 (2)</span></a></li><li ><a href="https://davidsiaw.github.io/2012/08"><i class="fa fa-calendar-o"></i><span class="nav-label">2012/08 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2011/11"><i class="fa fa-calendar-o"></i><span class="nav-label">2011/11 (2)</span></a></li><li ><a href="https://davidsiaw.github.io/2011/10"><i class="fa fa-calendar-o"></i><span class="nav-label">2011/10 (2)</span></a></li><li ><a href="https://davidsiaw.github.io/2011/09"><i class="fa fa-calendar-o"></i><span class="nav-label">2011/09 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2011/07"><i class="fa fa-calendar-o"></i><span class="nav-label">2011/07 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2010/08"><i class="fa fa-calendar-o"></i><span class="nav-label">2010/08 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2010/06"><i class="fa fa-calendar-o"></i><span class="nav-label">2010/06 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2009/12"><i class="fa fa-calendar-o"></i><span class="nav-label">2009/12 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2009/11"><i class="fa fa-calendar-o"></i><span class="nav-label">2009/11 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2009/05"><i class="fa fa-calendar-o"></i><span class="nav-label">2009/05 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2009/04"><i class="fa fa-calendar-o"></i><span class="nav-label">2009/04 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2009/03"><i class="fa fa-calendar-o"></i><span class="nav-label">2009/03 (4)</span></a></li><li ><a href="https://davidsiaw.github.io/2009/02"><i class="fa fa-calendar-o"></i><span class="nav-label">2009/02 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2009/01"><i class="fa fa-calendar-o"></i><span class="nav-label">2009/01 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/2008/11"><i class="fa fa-calendar-o"></i><span class="nav-label">2008/11 (3)</span></a></li><li ><a href="https://davidsiaw.github.io/2008/10"><i class="fa fa-calendar-o"></i><span class="nav-label">2008/10 (3)</span></a></li><li ><a href="https://davidsiaw.github.io/2008/09"><i class="fa fa-calendar-o"></i><span class="nav-label">2008/09 (3)</span></a></li><li ><a href="https://davidsiaw.github.io/2008/08"><i class="fa fa-calendar-o"></i><span class="nav-label">2008/08 (2)</span></a></li></ul></li><li open="false"><a href="https://davidsiaw.github.io/#"><i class="fa fa-tags"></i><span class="nav-label">Tags</span><span class="fa arrow"></span></a><ul class="nav nav-second-level "><li ><a href="https://davidsiaw.github.io/tags/c++"><i class="fa fa-tag"></i><span class="nav-label">c++ (6)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/opengl"><i class="fa fa-tag"></i><span class="nav-label">opengl (4)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/blogging"><i class="fa fa-tag"></i><span class="nav-label">blogging (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/blog"><i class="fa fa-tag"></i><span class="nav-label">blog (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/cellular automata"><i class="fa fa-tag"></i><span class="nav-label">cellular automata (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/ca"><i class="fa fa-tag"></i><span class="nav-label">ca (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/game of life"><i class="fa fa-tag"></i><span class="nav-label">game of life (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/hexagonal grid"><i class="fa fa-tag"></i><span class="nav-label">hexagonal grid (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/snippet"><i class="fa fa-tag"></i><span class="nav-label">snippet (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/intermediate mode"><i class="fa fa-tag"></i><span class="nav-label">intermediate mode (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/performance"><i class="fa fa-tag"></i><span class="nav-label">performance (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/programming"><i class="fa fa-tag"></i><span class="nav-label">programming (2)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/destructor"><i class="fa fa-tag"></i><span class="nav-label">destructor (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/exception"><i class="fa fa-tag"></i><span class="nav-label">exception (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/throw"><i class="fa fa-tag"></i><span class="nav-label">throw (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/wysiwyg"><i class="fa fa-tag"></i><span class="nav-label">wysiwyg (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/will it happen"><i class="fa fa-tag"></i><span class="nav-label">will it happen (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/client"><i class="fa fa-tag"></i><span class="nav-label">client (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/bunnyblogger"><i class="fa fa-tag"></i><span class="nav-label">bunnyblogger (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/beta"><i class="fa fa-tag"></i><span class="nav-label">beta (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/populate"><i class="fa fa-tag"></i><span class="nav-label">populate (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/constructor"><i class="fa fa-tag"></i><span class="nav-label">constructor (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/visual studio"><i class="fa fa-tag"></i><span class="nav-label">visual studio (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/unresolved"><i class="fa fa-tag"></i><span class="nav-label">unresolved (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/symbol"><i class="fa fa-tag"></i><span class="nav-label">symbol (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/msvc"><i class="fa fa-tag"></i><span class="nav-label">msvc (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/glew"><i class="fa fa-tag"></i><span class="nav-label">glew (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/external"><i class="fa fa-tag"></i><span class="nav-label">external (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/2010"><i class="fa fa-tag"></i><span class="nav-label">2010 (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/tight loop"><i class="fa fa-tag"></i><span class="nav-label">tight loop (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/glbegin"><i class="fa fa-tag"></i><span class="nav-label">glbegin (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/display list"><i class="fa fa-tag"></i><span class="nav-label">display list (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/saturation"><i class="fa fa-tag"></i><span class="nav-label">saturation (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/rgb"><i class="fa fa-tag"></i><span class="nav-label">rgb (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/simple"><i class="fa fa-tag"></i><span class="nav-label">simple (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/glsl"><i class="fa fa-tag"></i><span class="nav-label">glsl (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/example"><i class="fa fa-tag"></i><span class="nav-label">example (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/vertex"><i class="fa fa-tag"></i><span class="nav-label">vertex (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/vbo"><i class="fa fa-tag"></i><span class="nav-label">vbo (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/objects"><i class="fa fa-tag"></i><span class="nav-label">objects (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/enhancement"><i class="fa fa-tag"></i><span class="nav-label">enhancement (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/buffer"><i class="fa fa-tag"></i><span class="nav-label">buffer (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/sdl"><i class="fa fa-tag"></i><span class="nav-label">sdl (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/2d"><i class="fa fa-tag"></i><span class="nav-label">2d (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/tree"><i class="fa fa-tag"></i><span class="nav-label">tree (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/structure"><i class="fa fa-tag"></i><span class="nav-label">structure (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/rbsptree"><i class="fa fa-tag"></i><span class="nav-label">rbsptree (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/packing"><i class="fa fa-tag"></i><span class="nav-label">packing (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/lightmap"><i class="fa fa-tag"></i><span class="nav-label">lightmap (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/demo"><i class="fa fa-tag"></i><span class="nav-label">demo (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/data"><i class="fa fa-tag"></i><span class="nav-label">data (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/bsp"><i class="fa fa-tag"></i><span class="nav-label">bsp (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/algorithm"><i class="fa fa-tag"></i><span class="nav-label">algorithm (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/string.join"><i class="fa fa-tag"></i><span class="nav-label">string.join (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/separator"><i class="fa fa-tag"></i><span class="nav-label">separator (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/better way"><i class="fa fa-tag"></i><span class="nav-label">better way (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/shortening"><i class="fa fa-tag"></i><span class="nav-label">shortening (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/loop"><i class="fa fa-tag"></i><span class="nav-label">loop (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/for"><i class="fa fa-tag"></i><span class="nav-label">for (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/identity"><i class="fa fa-tag"></i><span class="nav-label">identity (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/compiler"><i class="fa fa-tag"></i><span class="nav-label">compiler (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/array"><i class="fa fa-tag"></i><span class="nav-label">array (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/timer"><i class="fa fa-tag"></i><span class="nav-label">timer (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/javascript"><i class="fa fa-tag"></i><span class="nav-label">javascript (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/cappuccino"><i class="fa fa-tag"></i><span class="nav-label">cappuccino (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/online"><i class="fa fa-tag"></i><span class="nav-label">online (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/neural"><i class="fa fa-tag"></i><span class="nav-label">neural (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/network"><i class="fa fa-tag"></i><span class="nav-label">network (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/batch"><i class="fa fa-tag"></i><span class="nav-label">batch (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/jekyll-bootstrap"><i class="fa fa-tag"></i><span class="nav-label">jekyll-bootstrap (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/github-pages"><i class="fa fa-tag"></i><span class="nav-label">github-pages (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/wordpress"><i class="fa fa-tag"></i><span class="nav-label">wordpress (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/jekyll"><i class="fa fa-tag"></i><span class="nav-label">jekyll (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/octopress"><i class="fa fa-tag"></i><span class="nav-label">octopress (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/travis"><i class="fa fa-tag"></i><span class="nav-label">travis (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/etcd"><i class="fa fa-tag"></i><span class="nav-label">etcd (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/testing"><i class="fa fa-tag"></i><span class="nav-label">testing (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/database"><i class="fa fa-tag"></i><span class="nav-label">database (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/mruby"><i class="fa fa-tag"></i><span class="nav-label">mruby (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/bittwiddling"><i class="fa fa-tag"></i><span class="nav-label">bittwiddling (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/c"><i class="fa fa-tag"></i><span class="nav-label">c (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/random"><i class="fa fa-tag"></i><span class="nav-label">random (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/gowin"><i class="fa fa-tag"></i><span class="nav-label">gowin (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/fpga"><i class="fa fa-tag"></i><span class="nav-label">fpga (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/hue"><i class="fa fa-tag"></i><span class="nav-label">hue (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/convert"><i class="fa fa-tag"></i><span class="nav-label">convert (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/color"><i class="fa fa-tag"></i><span class="nav-label">color (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/brightness"><i class="fa fa-tag"></i><span class="nav-label">brightness (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/alpha"><i class="fa fa-tag"></i><span class="nav-label">alpha (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/ahsb"><i class="fa fa-tag"></i><span class="nav-label">ahsb (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/regex"><i class="fa fa-tag"></i><span class="nav-label">regex (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/escape"><i class="fa fa-tag"></i><span class="nav-label">escape (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/characters"><i class="fa fa-tag"></i><span class="nav-label">characters (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/.net"><i class="fa fa-tag"></i><span class="nav-label">.net (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/text"><i class="fa fa-tag"></i><span class="nav-label">text (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/style"><i class="fa fa-tag"></i><span class="nav-label">style (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/span"><i class="fa fa-tag"></i><span class="nav-label">span (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/effect"><i class="fa fa-tag"></i><span class="nav-label">effect (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/css"><i class="fa fa-tag"></i><span class="nav-label">css (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/blur"><i class="fa fa-tag"></i><span class="nav-label">blur (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/visualization"><i class="fa fa-tag"></i><span class="nav-label">visualization (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/java"><i class="fa fa-tag"></i><span class="nav-label">java (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/cross product"><i class="fa fa-tag"></i><span class="nav-label">cross product (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/applet"><i class="fa fa-tag"></i><span class="nav-label">applet (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/practice"><i class="fa fa-tag"></i><span class="nav-label">practice (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/exceptionless"><i class="fa fa-tag"></i><span class="nav-label">exceptionless (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/unit types"><i class="fa fa-tag"></i><span class="nav-label">unit types (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/type safety"><i class="fa fa-tag"></i><span class="nav-label">type safety (1)</span></a></li><li ><a href="https://davidsiaw.github.io/tags/languages"><i class="fa fa-tag"></i><span class="nav-label">languages (1)</span></a></li></ul></li>

				</ul>
			</div>
		</nav>
		<div id="page-wrapper" class="gray-bg">
			<div class="row border-bottom">
		        <nav class="navbar navbar-static-top  " role="navigation" style="margin-bottom: 0">
					<div class="navbar-header">
					    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
					</div>
		            <ul class="nav navbar-top-links navbar-right">
		                <!-- NAV RIGHT -->
		            </ul>
		        </nav>
	        </div>
	<div class="row wrapper white-bg page-heading" style="">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <h1>Working with mruby</h1><h6>August 17, 2019 22:55</h6><hr  />
  </div>

	</div>
	<div class="row " style="">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <p><span class="dropcap">H</span>aving worked with Lua before and made a <a href="https://github.com/davidsiaw/luacppinterface">LuaCppInterface</a>, I decided about a year ago to start working on a C++ interface for mounting mruby as a scripting language.</p>

<p>To start, I have been developing in Ruby for several years now and I found it to be quite a pleasant language to work with. The particularly attractive thing about Ruby is its ability to create very clean DSLs. I have proceeded to use this to build some <a href="https://github.com/davidsiaw/sumomo">DSLs of</a> <a href="https://github.com/davidsiaw/weaver">my own</a>.</p>

<p>Despite the power of Ruby, it turned out to be incredibly hard to use as scripting language. However, recently a Japanese-Government-funded project <a href="http://www.mruby.org/">mruby</a> has been taking off and has headed into version 2.0.1. A year ago when I tried using it it was in version 1.4.0, and it was already in a fairly stable state. Since its syntax is meant to be compatible with Ruby 1.9 and its easy to compile into a C++ project, I decided to try it out.</p>

<h2>mruby-cpp</h2>

<p>To that end, I created <a href="https://github.com/davidsiaw/mruby-cpp">mruby-cpp</a> which provides a C++ frontend into mruby. Its still in beta as I trawl through the mruby C API and slowly gain an understanding of it. I&#39;ll continue to evolve it until it makes sense in both the C++ and mruby contexts.</p>

<h3>Simple introduction</h3>

<p>To start, <a href="https://github.com/davidsiaw/mruby-cpp">mruby-cpp</a> is a header-only C++ library. Just clone it into your sources as a submodule or copy it in and start using it. Your executable obviously needs to be linked with <code>libmruby.a</code>.</p>

<p>You can run scripts like this:</p>

<pre><code class="cpp">#include &lt;mruby.hpp&gt;

int main()
{
    vm.run(&quot;puts &#39;hello ruby&#39;&quot;);
    return 0;
}
</code></pre>

<p>You can also set and get global variables, instance variables and class variables:</p>

<pre><code class="cpp">vm.run(&quot;$a = 100;&quot;);
int global_a = vm.get_global_variable&lt;int&gt;(&quot;$a&quot;);

vm.run(&quot;@a = 100;&quot;);
int instance_a = vm.get_instance_variable&lt;int&gt;(&quot;@a&quot;);

vm.run(&quot;@@a = 100;&quot;);
int class_a = vm.get_class_variable&lt;int&gt;(&quot;@@a&quot;);
</code></pre>

<p>You can bind your C++ classes and their methods to mruby, and specify constructor arguments too!</p>

<pre><code class="cpp">class Person {
    int age;
public:
    Person(int age) : age(age) { }
    int how_old() const { return age; }
};

auto cls = vm.create_class&lt;Person&gt;(&quot;Person&quot;);
cls.bind_instance_method(&quot;how_old&quot;, &amp;Person::how_old);
vm.run(&quot;puts Person.new(5).how_old&quot;)
</code></pre>

<p>Hopefully you will have a good idea of what I plan to achieve with this library. There are more examples in the <a href="https://github.com/davidsiaw/mruby-cpp/tree/master/tests">tests folder</a>.</p>

<h3>See the tests for more examples!</h3>

<p>All the capabilities of <a href="https://github.com/davidsiaw/mruby-cpp">mruby-cpp</a> are tested by the <a href="https://github.com/davidsiaw/mruby-cpp/tree/master/tests">tests</a> which are also really good examples of how to use <a href="https://github.com/davidsiaw/mruby-cpp">mruby-cpp</a>.</p>

<h2>mruby</h2>

<p>While I was writing this library, I&#39;ve learned a few things about mruby and actually about Ruby itself too.</p>

<h3>The C API isn&#39;t well documented</h3>

<p>One of the first things I realize when I started looking for ways to do things in mruby is its C API is sparsely documented. There are a bunch of comments in the headers but they are not nearly detailed enough.</p>

<p>A lot of functions have very abbreviated names such as</p>

<pre><code class="c">mrb_value mrb_vm_special_get(mrb_state*, mrb_sym);
void mrb_vm_special_set(mrb_state*, mrb_sym, mrb_value);
mrb_value mrb_vm_cv_get(mrb_state*, mrb_sym);
void mrb_vm_cv_set(mrb_state*, mrb_sym, mrb_value);
mrb_value mrb_vm_const_get(mrb_state*, mrb_sym);
void mrb_vm_const_set(mrb_state*, mrb_sym, mrb_value);
</code></pre>

<p>I still don&#39;t know what <code>mrb_vm_special_get</code> mean, but I know <code>cv</code> means class variable and <code>const</code> means constant. These are the <code>vm</code> variations, which means they only access global scope. Strangely enough, matz removed <code>vm</code> variations for the instance variables. Not sure why that is the case.</p>

<p>Sometimes typenames are confusing and its not entirely clear how some types are converted to other types, such as <code>RProc*</code> and <code>mrb_value</code>.</p>

<h3>Difficulties I faced</h3>

<p>While writing mruby-cpp, I encountered some difficulty with unifying mruby objects. All things in mruby are objects but they are not treated that way in the API. This is something I still have to solve.</p>

<p>Contrast with Lua where it exposes its GC reference api allowing you to increment and decrement references to its objects, and allowing you to create your own objects on the Lua GC and reference them the same way. This means that you can basically have a variant of the <code>shared_pointer</code> but managed by the Lua GC.</p>

<p>In mruby when you create a function you are forced to assign it to a class with a name. However, you can create a <code>proc</code> but it has a transparent <code>self</code> keyword, which means its impossible to associate it to an object.</p>

<p>As a result, the easiest way to work with mruby-cpp right now is to create classes and bind functions to them so you can use them in mruby. It makes little to no sense creating a function and assigning it to a variable. I am still working on a nice way to do this, and I spent hours trying to find a way to pass a function to mruby as a callable object.</p>

<p>The differences between procs, objects, classes and modules also mean that it was difficult to create an <code>mruby::Object</code> class. Meaning, pure ruby objects cannot really be passed to C++ with mruby-cpp right now.</p>

  </div>

	</div>
	<div class="row " style="">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    
  </div>

	</div>
	<div class="row " style="">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <hr  /><br  /><br  /><script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

  </div>

	</div>

		</div>
	</div>

</div>

    <!-- Mainly scripts -->
    <script src="../../../../js/jquery-3.1.1.min.js"></script>
    <script src="../../../../js/jquery-ui-1.10.4.min.js"></script>
    <script src="../../../../js/bootstrap.min.js"></script>
    <script src="../../../../js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="../../../../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			asciimath2jax: {
				delimiters: [['$$$MATH$$$','$$$ENDMATH$$$']]
			}
		});
	</script>
    <script src="../../../../js/MathJax/MathJax.js?config=AM_HTMLorMML-full" async></script>

    <script src="../../../../js/highlight.min.js"></script>



    <!-- Custom and plugin javascript -->
    <script src="../../../../js/weaver.js"></script>
    <script src='../../../../js/plugins/pace/pace.min.js'></script>

    <script>



$( document ).ready(function() {

hljs.highlightAll();



});
    </script>



</body>

</html>

